<header class="fixed top-0 left-0 right-0 z-40 bg-[#171b25] border-[#5a6278] md:hidden">
    <div class="flex items-center px-4 py-3 h-16">
        <a asp-controller="home" asp-action="index" class="hidden flex items-center no-underline">
            <img src="@Url.Content("~/Assets/Imgs/App/logo_footer.png")" alt="Logo" class="h-[150px] w-auto object-contain" style="filter: drop-shadow(0 0 2px rgba(235, 236, 247, 0.4)) drop-shadow(0 0 4px rgba(235, 236, 247, 0.2));">
        </a>
    </div>
</header>

<nav class="fixed bottom-0 left-0 right-0 z-50 border-t border-[#5a6278] bg-[#171b25] shadow-[0_-4px_20px_rgba(0,0,0,0.3)] md:hidden pb-[env(safe-area-inset-bottom)]">
    <div class="flex items-center justify-around h-16 px-2">
        <a asp-controller="home" asp-action="index" 
           class="nav-link-mobile flex flex-col items-center gap-1 px-4 py-2 rounded-xl text-[#ebecf7] hover:text-[#ebecf7] hover:bg-white/5 transition-all data-[active=true]:text-cyan-400 no-underline"
           data-page="home">
                <i class="fa-solid fa-house text-lg text-[#ebecf7]"></i>
            <span class="text-[10px] font-medium text-[#ebecf7]">Hem</span>
        </a>
        <a href="#services" 
           class="nav-link-mobile flex flex-col items-center gap-1 px-4 py-2 rounded-xl text-[#ebecf7] hover:text-[#ebecf7] hover:bg-white/5 transition-all data-[active=true]:text-cyan-400 no-underline"
           data-page="services">
            <i class="fa-solid fa-briefcase text-lg text-[#ebecf7]"></i>
            <span class="text-[10px] font-medium text-[#ebecf7]">Tjänster</span>
        </a>
        <a href="#before-after" 
           class="nav-link-mobile flex flex-col items-center gap-1 px-4 py-2 rounded-xl text-[#ebecf7] hover:text-[#ebecf7] hover:bg-white/5 transition-all data-[active=true]:text-cyan-400 no-underline"
           data-page="before-after">
            <i class="fa-solid fa-images text-lg text-[#ebecf7]"></i>
            <span class="text-[10px] font-medium text-[#ebecf7]">Tidigare jobb</span>
        </a>
        <a href="#contact-form" 
           class="nav-link-mobile flex flex-col items-center gap-1 px-4 py-2 rounded-xl text-[#ebecf7] hover:text-[#ebecf7] hover:bg-white/5 transition-all data-[active=true]:text-cyan-400 no-underline"
           data-page="contact">
            <i class="fa-solid fa-envelope text-lg text-[#ebecf7]"></i>
            <span class="text-[10px] font-medium text-[#ebecf7]">Kontakt</span>
        </a>
        @if (signInManager.IsSignedIn(User))
        {
            @if (User.IsInRole("Admin"))
            {
                <a asp-controller="admin" asp-action="users" 
                   class="nav-link-mobile flex flex-col items-center gap-1 px-4 py-2 rounded-xl text-[#ebecf7] hover:text-[#ebecf7] hover:bg-white/5 transition-all data-[active=true]:text-cyan-400 no-underline"
                   data-page="admin">
                    <i class="fa-solid fa-gauge-high text-lg text-[#ebecf7]"></i>
                    <span class="text-[10px] font-medium text-[#ebecf7]">Admin</span>
                </a>
            }
            <a asp-controller="account" asp-action="Index" 
               class="nav-link-mobile flex flex-col items-center gap-1 px-4 py-2 rounded-xl text-[#ebecf7] hover:text-[#ebecf7] hover:bg-white/5 transition-all data-[active=true]:text-cyan-400 no-underline"
               data-page="account">
                <div class="flex items-center justify-center w-6 h-6 rounded-full bg-linear-to-br from-cyan-500 to-cyan-600 text-[#ebecf7] text-[10px] font-bold">
                    @(User.Identity?.Name?.Substring(0, 1).ToUpper())
                </div>
                <span class="text-[10px] font-medium text-[#ebecf7]">Profil</span>
            </a>
        }
    </div>
</nav>

<aside id="sidebar" 
       class="group/sidebar hidden md:flex fixed top-4 left-4 bottom-4 z-50 w-56 flex-col rounded-2xl border border-[#5a6278] bg-[#171b25] backdrop-blur-md shadow-2xl transition-[width] duration-300 ease-in-out">
    
    <div class="sidebar-logo-container flex items-center p-4">
        <a href="/" class="flex items-center w-full overflow-hidden no-underline sidebar-logo transition-all duration-200">
            <img src="@Url.Content("~/Assets/Imgs/App/logo_footer.png")" alt="Logo" class="w-full h-auto object-contain shrink-0" style="filter: drop-shadow(0 0 2px rgba(235, 236, 247, 0.4)) drop-shadow(0 0 4px rgba(235, 236, 247, 0.2));">
        </a>
    </div>
    
    <nav class="flex-1 py-6 px-3 space-y-2 overflow-y-auto overflow-x-hidden">
        <div class="nav-item relative group">
            <a asp-controller="home" asp-action="index" 
               class="nav-link flex items-center gap-4 px-4 py-3 rounded-xl text-[#ebecf7] hover:text-[#ebecf7] hover:bg-white/10 transition-all data-[active=true]:text-cyan-400 no-underline"
               data-page="home">
                <i class="fa-solid fa-house text-base shrink-0 w-5 text-center text-[#ebecf7]"></i>
                <span class="sidebar-text text-sm font-medium whitespace-nowrap transition-all duration-200 text-[#ebecf7]">Hem</span>
            </a>
            <div class="tooltip hidden absolute left-full top-1/2 -translate-y-1/2 ml-3 px-3 py-1.5 rounded-lg bg-white text-[#001021] text-sm font-medium whitespace-nowrap shadow-xl z-50 opacity-0 pointer-events-none transition-opacity group-hover:opacity-100">
                Hem
            </div>
        </div>
        
        <div class="nav-item relative group">
            <a href="#services" 
               class="nav-link flex items-center gap-4 px-4 py-3 rounded-xl text-[#ebecf7] hover:text-[#ebecf7] hover:bg-white/10 transition-all data-[active=true]:text-cyan-400 no-underline"
               data-page="services">
                <i class="fa-solid fa-briefcase text-base shrink-0 w-5 text-center text-[#ebecf7]"></i>
                <span class="sidebar-text text-sm font-medium whitespace-nowrap transition-all duration-200 text-[#ebecf7]">Tjänster</span>
            </a>
            <div class="tooltip hidden absolute left-full top-1/2 -translate-y-1/2 ml-3 px-3 py-1.5 rounded-lg bg-white text-[#001021] text-sm font-medium whitespace-nowrap shadow-xl z-50 opacity-0 pointer-events-none transition-opacity group-hover:opacity-100">
                Tjänster
            </div>
        </div>
        
        <div class="nav-item relative group">
            <a href="#before-after" 
               class="nav-link flex items-center gap-4 px-4 py-3 rounded-xl text-[#ebecf7] hover:text-[#ebecf7] hover:bg-white/10 transition-all data-[active=true]:text-cyan-400 no-underline"
               data-page="before-after">
                <i class="fa-solid fa-images text-base shrink-0 w-5 text-center text-[#ebecf7]"></i>
                <span class="sidebar-text text-sm font-medium whitespace-nowrap transition-all duration-200 text-[#ebecf7]">Tidigare jobb</span>
            </a>
            <div class="tooltip hidden absolute left-full top-1/2 -translate-y-1/2 ml-3 px-3 py-1.5 rounded-lg bg-white text-[#001021] text-sm font-medium whitespace-nowrap shadow-xl z-50 opacity-0 pointer-events-none transition-opacity group-hover:opacity-100">
                Tidigare jobb
            </div>
        </div>
        
        <div class="nav-item relative group">
            <a href="#contact-form" 
               class="nav-link flex items-center gap-4 px-4 py-3 rounded-xl text-[#ebecf7] hover:text-[#ebecf7] hover:bg-white/10 transition-all data-[active=true]:text-cyan-400 no-underline"
               data-page="contact">
                <i class="fa-solid fa-envelope text-base shrink-0 w-5 text-center text-[#ebecf7]"></i>
                <span class="sidebar-text text-sm font-medium whitespace-nowrap transition-all duration-200 text-[#ebecf7]">Kontakt</span>
            </a>
            <div class="tooltip hidden absolute left-full top-1/2 -translate-y-1/2 ml-3 px-3 py-1.5 rounded-lg bg-white text-[#001021] text-sm font-medium whitespace-nowrap shadow-xl z-50 opacity-0 pointer-events-none transition-opacity group-hover:opacity-100">
                Kontakt
            </div>
        </div>
        
        @if (signInManager.IsSignedIn(User))
        {
            <div class="my-4 mx-3 h-px bg-white/10"></div>
            
            @if (User.IsInRole("Admin"))
            {
                <div class="nav-item relative group">
                    <a asp-controller="admin" asp-action="users" 
                       class="nav-link flex items-center gap-4 px-4 py-3 rounded-xl text-[#ebecf7] hover:text-[#ebecf7] hover:bg-white/10 transition-all data-[active=true]:text-cyan-400 no-underline"
                       data-page="admin">
                        <i class="fa-solid fa-gauge-high text-base shrink-0 w-5 text-center text-[#ebecf7]"></i>
                        <span class="sidebar-text text-sm font-medium whitespace-nowrap transition-all duration-200 text-[#ebecf7]">Dashboard</span>
                    </a>
                    <div class="tooltip hidden absolute left-full top-1/2 -translate-y-1/2 ml-3 px-3 py-1.5 rounded-lg bg-white text-[#001021] text-sm font-medium whitespace-nowrap shadow-xl z-50 opacity-0 pointer-events-none transition-opacity group-hover:opacity-100">
                        Dashboard
                    </div>
                </div>
            }
            
            <div class="nav-item relative group">
                <a asp-controller="account" asp-action="Index" 
                   class="nav-link flex items-center gap-4 px-4 py-3 rounded-xl text-[#ebecf7] hover:text-[#ebecf7] hover:bg-white/10 transition-all data-[active=true]:text-cyan-400 no-underline"
                   data-page="account">
                    <div class="flex items-center justify-center w-6 h-6 rounded-full bg-linear-to-br from-cyan-500 to-cyan-600 text-[#ebecf7] text-xs font-bold shrink-0">
                        @(User.Identity?.Name?.Substring(0, 1).ToUpper())
                    </div>
                    <span class="sidebar-text text-sm font-medium whitespace-nowrap transition-all duration-200 truncate text-[#ebecf7]">@User.Identity?.Name</span>
                </a>
                <div class="tooltip hidden absolute left-full top-1/2 -translate-y-1/2 ml-3 px-3 py-1.5 rounded-lg bg-white text-[#001021] text-sm font-medium whitespace-nowrap shadow-xl z-50 opacity-0 pointer-events-none transition-opacity group-hover:opacity-100">
                    @User.Identity?.Name
                </div>
            </div>
        }
    </nav>
    
    <div class="px-3 py-4 border-[#5a6278]">
        @if (signInManager.IsSignedIn(User))
        {
            <div class="nav-item relative group">
                <a asp-controller="account" asp-action="signout" 
                   class="nav-link flex items-center gap-4 px-4 py-3 rounded-xl text-[#ebecf7] hover:text-[#ebecf7] hover:bg-red-500/10 transition-all no-underline">
                    <i class="fa-solid fa-arrow-right-from-bracket text-base shrink-0 w-5 text-center text-[#ebecf7]"></i>
                    <span class="sidebar-text text-sm font-medium whitespace-nowrap transition-all duration-200 text-[#ebecf7]">Logga ut</span>
                </a>
                <div class="tooltip hidden absolute left-full top-1/2 -translate-y-1/2 ml-3 px-3 py-1.5 rounded-lg bg-white text-[#001021] text-sm font-medium whitespace-nowrap shadow-xl z-50 opacity-0 pointer-events-none transition-opacity group-hover:opacity-100">
                    Logga ut
                </div>
            </div>
        }
        <div class="sidebar-toggle-container mt-3 flex items-center justify-between">
            <a asp-controller="home" asp-action="tos" 
               class="sidebar-text text-[#ebecf7] hover:text-[#ebecf7] text-xs transition-all duration-200 whitespace-nowrap no-underline">
                Användarvillkor
            </a>
            <button id="sidebar-toggle" 
                    type="button"
                    aria-label="Minimera meny"
                    class="p-2 bg-transparent border-none rounded-xl text-[#ebecf7] hover:text-[#ebecf7] hover:bg-white/10 transition-all shrink-0 flex items-center justify-center">
                <i id="toggle-icon" class="fa-solid fa-angles-left text-lg transition-transform duration-300"></i>
            </button>
        </div>
    </div>
</aside>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const sidebar = document.getElementById('sidebar');
        const toggle = document.getElementById('sidebar-toggle');
        const toggleIcon = document.getElementById('toggle-icon');
        const STORAGE_KEY = 'sidebar-minimized';
        
        const sidebarTexts = sidebar?.querySelectorAll('.sidebar-text');
        const sidebarLogo = sidebar?.querySelector('.sidebar-logo');
        const sidebarLogoContainer = sidebar?.querySelector('.sidebar-logo-container');
        const toggleButtonContainer = sidebar?.querySelector('.sidebar-toggle-container');
        const tooltips = sidebar?.querySelectorAll('.tooltip');
        
        const applyMinimized = (minimized) => {
            if (!sidebar) return;
            
            const navLinks = sidebar.querySelectorAll('.nav-link');
            const navItems = sidebar.querySelectorAll('.nav-item');
            const nav = sidebar.querySelector('nav');
            
            if (minimized) {
                sidebar.classList.remove('w-56');
                sidebar.classList.add('w-[4.5rem]');
                toggleIcon?.classList.add('rotate-180');
                
                sidebarTexts?.forEach(el => {
                    el.classList.add('opacity-0', 'w-0', 'overflow-hidden');
                });
                
                sidebarLogo?.classList.add('opacity-0', 'w-0', 'overflow-hidden');
                sidebarLogoContainer?.classList.remove('p-4');
                sidebarLogoContainer?.classList.add('p-0', 'h-0', 'overflow-hidden');
                
                tooltips?.forEach(el => {
                    el.classList.remove('hidden');
                });
                
                // Improve spacing when collapsed
                nav?.classList.remove('space-y-2', 'px-3', 'py-6');
                nav?.classList.add('space-y-1', 'px-2', 'pt-0', 'pb-6');
                navItems?.forEach(item => {
                    item.classList.add('flex', 'justify-center');
                });
                navLinks?.forEach(link => {
                    link.classList.remove('px-4', 'py-3', 'gap-4');
                    link.classList.add('px-2', 'py-2.5', 'justify-center', 'w-full', 'gap-0');
                    // Update icon sizes in nav links when collapsed
                    const icon = link.querySelector('i');
                    if (icon) {
                        icon.classList.remove('text-base', 'w-5');
                        icon.classList.add('text-sm', 'w-4');
                    }
                });
                
                // Center the toggle button container when collapsed
                toggleButtonContainer?.classList.remove('justify-between');
                toggleButtonContainer?.classList.add('justify-center');
            } else {
                sidebar.classList.remove('w-[4.5rem]');
                sidebar.classList.add('w-56');
                toggleIcon?.classList.remove('rotate-180');
                
                sidebarTexts?.forEach(el => {
                    el.classList.remove('opacity-0', 'w-0', 'overflow-hidden');
                });
                
                sidebarLogo?.classList.remove('opacity-0', 'w-0', 'overflow-hidden');
                sidebarLogoContainer?.classList.remove('p-0', 'h-0', 'overflow-hidden');
                sidebarLogoContainer?.classList.add('p-4');
                
                tooltips?.forEach(el => {
                    el.classList.add('hidden');
                });
                
                // Restore original spacing when expanded
                nav?.classList.remove('space-y-1', 'px-2', 'pt-0', 'pb-6');
                nav?.classList.add('space-y-2', 'px-3', 'py-6');
                navItems?.forEach(item => {
                    item.classList.remove('flex', 'justify-center');
                });
                navLinks?.forEach(link => {
                    link.classList.remove('px-2', 'py-2.5', 'justify-center', 'w-full', 'gap-0');
                    link.classList.add('px-4', 'py-3', 'gap-4');
                    // Restore icon sizes in nav links when expanded
                    const icon = link.querySelector('i');
                    if (icon) {
                        icon.classList.remove('text-sm', 'w-4');
                        icon.classList.add('text-base', 'w-5');
                    }
                });
                
                // Restore toggle button container layout when expanded
                toggleButtonContainer?.classList.remove('justify-center');
                toggleButtonContainer?.classList.add('justify-between');
            }
        };
        
        const savedState = localStorage.getItem(STORAGE_KEY) === 'true';
        applyMinimized(savedState);
        
        toggle?.addEventListener('click', () => {
            const isMinimized = sidebar.classList.contains('w-[4.5rem]');
            const newState = !isMinimized;
            
            applyMinimized(newState);
            localStorage.setItem(STORAGE_KEY, newState.toString());
        });
        
        const currentPath = window.location.pathname.toLowerCase();
        const links = document.querySelectorAll('.nav-link, .nav-link-mobile');
        
        links.forEach(link => {
            const page = link.dataset.page;
            let isActive = false;
            
            if (page === 'home' && (currentPath === '/' || currentPath === '/home' || currentPath === '/home/index')) {
                isActive = true;
            } else if (page === 'services' && (currentPath === '/' || currentPath === '/home' || currentPath === '/home/index')) {
                isActive = true;
            } else if (page === 'before-after' && (currentPath === '/' || currentPath === '/home' || currentPath === '/home/index')) {
                isActive = true;
            } else if (page === 'contact' && (currentPath === '/' || currentPath === '/home' || currentPath === '/home/index')) {
                isActive = true;
            } else if (page === 'admin' && currentPath.includes('/admin')) {
                isActive = true;
            } else if (page === 'account' && currentPath.includes('/account')) {
                isActive = true;
            }
            
            if (isActive) {
                link.dataset.active = 'true';
            }
        });
        
        const servicesLinks = document.querySelectorAll('a[href="#services"]');
        servicesLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const servicesSection = document.getElementById('services');
                if (servicesSection) {
                    servicesSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
        });
        
        const contactLinks = document.querySelectorAll('a[href="#contact-form"]');
        contactLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const contactForm = document.getElementById('contact-form');
                if (contactForm) {
                    contactForm.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    setTimeout(() => {
                        const firstInput = contactForm.querySelector('input, textarea');
                        if (firstInput) firstInput.focus();
                    }, 500);
                }
            });
        });
        
        const beforeAfterLinks = document.querySelectorAll('a[href="#before-after"]');
        beforeAfterLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const beforeAfterSection = document.getElementById('before-after');
                if (beforeAfterSection) {
                    beforeAfterSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
        });
    });
</script>